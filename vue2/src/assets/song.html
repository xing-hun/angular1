<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
		<link rel="stylesheet" href="./css/swiper-3.3.1.min.css" />
		<link rel="stylesheet" href="./css/song.css">
		<link rel="stylesheet" href="./imgs/font/iconfont.css" />
	</head>

	<body>
		<div class="blur">
			<img src="./imgs/818335895.jpg" />
			<div class="blurbox"></div>
		</div>
		<div class="wrap">
			<div class="upside">
				<div class="up_btns clearfloat" style="display:block">
					<a class="home fl" href="###"></a>
					<a class="share fr" id="sharebtn"></a>
					<a class="openApp fr" id="openApp">打开APP</a>
				</div>
				<div class="tabbox">
					<div class="swiper-container">
						<div class="swiper-wrapper">
							<div class="swiper-slide">
								<div class="lyric__box">
									<div class="lyric__text" id="lyric__text">
										<!--<p id='lyric0'>凉凉 (《三生三世十里桃花》电视剧片尾曲) - 杨宗纬/张碧晨
										</p>
										<p id='lyric2'>词：刘畅
										</p>
										<p id='lyric2'>曲：谭旋
										</p>
										<p id='lyric2'>编曲：韦国赟
										</p>
										<p id='lyric3'>
										</p>
										<p id='lyric46'>女：
										</p>
										<p id='lyric46'>
										</p>
										<p id='lyric48'>入夜渐微凉
										</p>
										<p id='lyric49'>繁花落地成霜
										</p>
										<p id='lyric52'>你在远方眺望
										</p>
										<p id='lyric55'>耗尽所有暮光
										</p>
										<p id='lyric57'>
										</p>
										<p id='lyric58'>不思量自难相忘
										</p>
										<p id='lyric64'>
										</p>
										<p id='lyric67'>男：
										</p>
										<p id='lyric68'>
										</p>
										<p id='lyric69'>夭夭桃花凉
										</p>
										<p id='lyric70'>
										</p>
										<p id='lyric71'>前世你怎舍下
										</p>-->
									</div>
								</div>
							</div>
							<div class="swiper-slide">

								<div class="simibox">
									<div class="simigedan">
										<h3>包含这首歌的歌单</h3>
										<ul>
											<li class="clearfloat">
												<a class="simigedanpic fl"><img src="./imgs/1489190329751_468483195_150.jpg" /></a>
												<div class="simigedaninfo fl">
													<p class="single_sname gedanname">蒙面唱将猜猜猜 现场音源全集</p>
													<p class="single_aname gedannum"><span>100</span>首歌</p>
												</div>
											</li>

											<li class="clearfloat">
												<a class="simigedanpic fl"><img src="./imgs/1489197896397_125467636_150.jpg" /></a>
												<div class="simigedaninfo fl">
													<p class="single_sname gedanname">Jam</p>
													<p class="single_aname gedannum"><span>100</span>首歌</p>
												</div>
											</li>
										</ul>
									</div>
									<div class="simisongs">
										<h3>相似歌曲</h3>
										<div class="ssinfo">
											<ul>
												<li class="clearfloat">
													<span class="single_sname fl">别想她</span>
													<span class="single_aname fl">&nbsp;—&nbsp;高进</span>
												</li>
												<li class="clearfloat">
													<span class="single_sname fl">眉间雪</span>
													<span class="single_aname fl">&nbsp;—&nbsp;HITA</span>
												</li>
												<li class="clearfix">
													<span class="single_sname fl">好梦如旧</span>
													<span class="single_aname fl">&nbsp;—&nbsp;HITA&&林斜阳</span>
												</li>
												<li class="clearfix">
													<span class="single_sname fl">昔言</span>
													<span class="single_aname fl">&nbsp;—&nbsp;HITA</span>
												</li>
												<li class="clearfix">
													<span class="single_sname fl">采薇</span>
													<span class="single_aname fl">&nbsp;—&nbsp;HITA</span>
												</li>
											</ul>
										</div>

									</div>
								</div>
							</div>
						</div>
						<div class="swiper-pagination"></div>
					</div>
				</div>
				<!--tabbox结束-->

			</div>
			
			<div class="downside" id="downside">
				<div class="singleinfo clearfloat">
					<div class="single_pic fl">
						<img src="./imgs/818335895.jpg" />
					</div>
					<div class="single_detail fl">
						<p class="single_sname" id="down_single_sname">刚好遇见你</p>
						<p class="single_aname" id="down_single_aname">李玉刚 - 刚好遇见你(单曲)</p>
						<div class="playbox">
							<div class="playbar fl">
								<div class="playline">
									<div class="playline_clone" id="playline_clone"></div>
								</div>
							</div>
							<span class="currtime fl" id="currtime">00:00</span>
							<span class="fenge fl">/</span>
							<span class="totaltime fl" id="totaltime">00:00</span>
						</div>
					</div>
					<div class="single_playbtn fr" id="single_playbtn"></div>
				</div>
				<div class="singleother clearfloat">
					<a class="single_list fl" id="single_list"></a>
					<a class="single_down fl">免费下载这首歌</a>

					<a class="single_artist fr" style="display:block" href="###"></a>

				</div>
			</div>
			<div class="single_queue" id="single_queue">
				<h3 id="queue_title">播放队列（<span>190</span>首）</h3>
				<div class="queue_content" id="queue_content">
					<ul class="single_playlist" id="single_playlist">
						<!--<li class="clearfloat">
							<span class="sing_sname fl">刚好遇见你</span>
							<span class="sing_aname fl"> — 李玉刚</span>
							<span class="fr"></span>
						</li>						-->
					</ul>
				</div>
				<div class="queue_close" id="queue_close">关闭</div>
			</div>

			<!--share box start-->
			<!--<div class="sharebox" id="sharebox">
				<span class="close" id="close"></span>
				<div class="shareinfo clearfloat">
					<a class="sharepic fl">
						<img src="http://img1.kwcdn.kuwo.cn/star/albumcover/240/45/21/19331829.jpg" />
					</a>
					<div class="sharetxt fl">
						<p>分享给你的朋友，</p>
						<p>用歌曲感染你的小伙伴</p>
					</div>
				</div>
				<div class="sharearea" id="sharearea" json="{'comName':'刚好遇见你','type':'singles'}">
					<a class="sweixin" fs="wx"></a>
					<a class="sqq" fs="tt"></a>
					<a class="sweibo" fs="wb"></a>
					<a class="szone" fs="qz"></a>
				</div>
				
			</div>-->

		</div>
		<audio id="audio" src="1"></audio>
		<script src="./js/jquery.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/swiper-3.3.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/index.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/common.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			$(function() {
				$('#single_playbtn').click(function() {
					if(audio.paused) {
						audio.play();
						$('#single_playbtn').addClass('off');
					} else {
						audio.pause();
						$('#single_playbtn').removeClass('off');
					}
				})
				$('#single_list').click(function() {
					$('#single_queue').animate({
						bottom: "0"
					}, "fast");
					$('#downside').hide();
				})
				$('#queue_close').click(function() {
					$('#single_queue').animate({
						bottom: "-2.64rem"
					}, "fast");
					$('#downside').show();
				})

				$.get('http://route.showapi.com/213-4', {
					showapi_appid: 35031,
					showapi_sign: '3e30f2f2169e48ada8e931449b9e2503',
					topid: 26
				}, function(data) {
					console.log(data);
					if(data && data.showapi_res_code == 0) {
						var data = data.showapi_res_body.pagebean.songlist;
//						console.log(data)

						for(var i = 0; i < data.length; i++) {
							var str = '<li class="lists clearfloat" data-url="' + data[i].url + '" data-id="' + i + '" data-imgUrl="' + data[i].albumpic_small + '" data-albumpic_big="' + data[i].albumpic_big + '" data-songid="' + data[i].songid + '">' +
								'<span class="sing_sname fl">' + data[i].songname + '</span>' +
								'<span class="sing_aname fl"> - ' + data[i].singername + '</span>' +
								'<span class="state fr"><span>'
								'</li>'
							$('#single_playlist').append(str);
						}
					}

				})

				$('#single_playlist').on('click', 'li', function() {
					
					$(this).find('.state').addClass('playstate').end().siblings().find('.state').removeClass('playstate');
					$(this).addClass("playing").siblings().removeClass("playing");
					var url1 = $(this).attr('data-url');
					console.log(url1)
					var musicid = $(this).attr('data-songid');
					console.log(musicid)
					$('#audio').attr('src', url1);
					if(audio.paused) {
						audio.play();
						$('#single_playbtn').addClass('off');
					} else {
						audio.pause();
						$('#single_playbtn').removeClass('off');
					}
					$.get('http://route.showapi.com/213-2', {
						showapi_appid: 35031,
						showapi_sign: '3e30f2f2169e48ada8e931449b9e2503',
						musicid: musicid
					}, function(data) {
						console.log(data);
						if(data && data.showapi_res_code == 0) {
							var data = data.showapi_res_body.lyric;

							var lyricIndex = JSON.stringify(data);
//							console.log("lyricIndex=" + lyricIndex);

							function unescapeHTML(str) {
								var t = document.createElement("div");
								t.innerHTML = str;
								return t.textContent || t.innerText;
							}
							var txt = unescapeHTML(lyricIndex);
//							console.log('txt=' + txt);

							var lyric1 = lyric_ctrl(txt);
//							console.log('lyric1 =' + lyric1);

							$('#lyric__text').html(lyric1);

							function lyric_ctrl(lyricObj) {
								var temp = lyricObj.split("[");
								var html = "";
								for(var i = 0; i < temp.length; i++) {
									var arr = temp[i].split("]");
									var text = (arr[1]);
									var time = arr[0].split(",");
									var temp2 = time[0].split(".");
									var ms = temp2[1]; //毫秒
									var temp3 = temp2[0].split(":");
									var s = temp3[1]; //秒
									var m = temp3[0]; //分
									var s_sum = parseInt(m * 60) + parseInt(s);
									if(text) {
										html += "<p id='lyric" + s_sum + "'>" + text + "</p>";
									}
								}
								return html;
							}

						}

					});
				})
				audio.addEventListener("timeupdate", function() {
					//console.log("allTime=" + audio.duration);
					$('#totaltime').text(format(audio.duration));
					var id_num = parseInt(audio.currentTime);
					$('#currtime').text(format(audio.currentTime));

					var bar_width = (audio.currentTime / audio.duration) * 100 + "%";
					$('#playline_clone').css("width", bar_width);

					//歌词滚动	
					var ly = $('.lyric__box').height();
					$('#lyric__text p').each(function(index, item) {
						var top1 = $(this).position().top;
						$(item).attr('data-top', top1);
					})
					console.log('ly=' + ly);
					if($("#lyric" + id_num)) {
						$("#lyric" + id_num).addClass("active").siblings().removeClass("active");
						var t = ly / 2 - $("#lyric" + id_num).attr('data-top');
						console.log("t=" + t)
						$('#lyric__text').css("top", t);
					}
				})

				function format(time) {
					var time = parseInt(time);
					var m = parseInt(time / 60);
					var s = parseInt(time % 60);
					m = zero(m);
					s = zero(s);

					function zero(num) {
						if(num < 10) {
							num = "0" + num;
						}
						return num;
					}
					return m + ":" + s;
				}
			})
		</script>
	</body>

</html>